<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Register</title>
<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  }
  .container { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 1rem; }
  .card { background-color: #fff; padding: 2rem; border-radius: 1rem; box-shadow: 0 8px 16px rgba(0,0,0,0.2); max-width: 700px; width: 100%; }
  .header { text-align: center; font-size: 1.75rem; font-weight: 700; margin-bottom: 1.5rem; color: #2d3748; }
  .role-buttons { display: flex; flex-wrap: wrap; justify-content: space-around; gap: 0.75rem; margin-bottom: 1.5rem; }
  .role-btn { background-color: #27ae60; color: #fff; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; transition: background 0.3s; min-width: 100px; text-align: center; }
  .role-btn:hover { background-color: #219150; }
  #registerForm { display: none; margin-top: 1rem; }
  #registerForm.show { display: block; }
  .form-group { margin-bottom: 1rem; }
  label { display: block; margin-bottom: 0.25rem; font-weight: 600; color: #4a5568; }
  input, textarea { width: 100%; padding: 0.5rem; border: 1px solid #cbd5e0; border-radius: 0.375rem; font-size: 1rem; }
  button[type="submit"] { width: 100%; padding: 0.75rem; background-color: #48bb78; color: #fff; font-size: 1rem; border: none; border-radius: 0.5rem; cursor: pointer; transition: background 0.3s; }
  button[type="submit"]:hover { background-color: #38a169; }
  .back-btn { display: inline-block; margin-bottom: 1rem; padding: 0.5rem 1rem; background-color: #27ae60; color: #fff; border-radius: 0.5rem; text-decoration: none; font-weight: 600; transition: background 0.3s; }
  .back-btn:hover { background-color: #219150; }
</style>
</head>
<body>
<div class="container">
  <div class="card">

    <a href="login.html" class="back-btn">Back to Login</a>

    <h2 class="header">Create an Account</h2>
    
    <div class="role-buttons">
      <div class="role-btn" onclick="setRole('Donor')">Donor</div>
      <div class="role-btn" onclick="setRole('Volunteer')">Volunteer</div>
      <div class="role-btn" onclick="setRole('Organization')">Organization</div>
      <div class="role-btn" onclick="setRole('Admin')">Admin</div>
    </div>
    
    <form id="registerForm" onsubmit="handleSubmit(event)">
      <input type="hidden" id="role" name="role" />

      <!-- Common fields -->
      <div class="form-group"><label>Name</label><input type="text" name="name" required /></div>
      <div class="form-group"><label>Email</label><input type="email" name="email" required /></div>
      <div class="form-group"><label>Phone</label><input type="tel" name="phone" pattern="[789][0-9]{9}" maxlength="10" required /></div>
      <div class="form-group"><label>Door No</label><input type="text" name="doorNo" required /></div>
      <div class="form-group"><label>Street</label><input type="text" name="street" required /></div>
      <div class="form-group"><label>City</label><input type="text" name="city" required /></div>
      <div class="form-group"><label>State</label><input type="text" name="state" required /></div>
      <div class="form-group"><label>Pincode</label><input type="text" name="pincode" required /></div>
      <div class="form-group"><label>Password</label><input type="password" name="password" id="password" required /></div>
      <div class="form-group"><label>Confirm Password</label><input type="password" name="confirmpassword" id="confirmpassword" required /></div>

      <!-- Role-specific fields -->
      <div id="roleFields"></div>

      <button type="submit">Register</button>
    </form>
    
  </div>
</div>

<script>
  function setRole(role) {
    const form = document.getElementById('registerForm');
    form.classList.add('show');
    document.getElementById('role').value = role;
    let html = '';
    if (role === 'Volunteer') {
      html = `
        <div class="form-group"><label>Skills</label><input type="text" name="skills" required /></div>
        <div class="form-group"><label>Previous Experiences</label><textarea name="experience" required></textarea></div>
      `;
    } else if (role === 'Organization') {
      html = `
        <div class="form-group"><label>Organization Name</label><input type="text" name="orgName" required /></div>
        <div class="form-group"><label>Registration Number</label><input type="text" name="regNumber" required /></div>
        <div class="form-group"><label>Description</label><textarea name="description" required></textarea></div>
        <div class="form-group"><label>Reference Links (comma separated)</label><input type="text" name="refLinks" required /></div>
      `;
    } else if (role === 'Admin') {
      html = `<div class="form-group"><label>Admin Code</label><input type="text" name="adminCode" required /></div>`;
    }
    document.getElementById('roleFields').innerHTML = html;
  }

  function validatePassword(pw) {
    const minLen = 8;
    return pw.length >= minLen &&
           /[A-Z]/.test(pw) &&
           /[a-z]/.test(pw) &&
           /[0-9]/.test(pw) &&
           /[!@#$%^&*(),.?":{}|<>]/.test(pw);
  }

  function handleSubmit(e) {
    e.preventDefault();
    const form = e.target;
    const email = form.email.value;
    const phone = form.phone.value;
    const password = form.password.value;
    const confPassword = form.confirmpassword.value;

    if (!/^[^@]+@.*\./.test(email)) return alert("Invalid email");
   // if (!/^[7-9]\\d{9}$/.test(phone)) return alert("Phone must start with 7,8,9 and be 10 digits");
    if (!validatePassword(password)) return alert("Weak password");
    if (password !== confPassword) return alert("Passwords do not match");

    const data = Object.fromEntries(new FormData(form));

    fetch('http://localhost:3000/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(response => {
      alert(response.message || 'Registration successful!');
      form.reset();
      document.getElementById('role').value = '';
      document.getElementById('roleFields').innerHTML = '';
      form.classList.remove('show');
    })
    .catch(() => alert('Registration failed.'));
  }
</script>
</body>
</html>
